var FormBouncer=function(){var a=function(a,b){this.target=a,this.message=b,this.toString=function(){return b}},b=function(a,b){this.target=a,this.validator=b},c={stopOnError:!0,instantAll:!0},d=function(a,e){var f,g=$.extend({},c,e||{}),h=[],i=function(a){var b=[],c=0,d=a.length;!function e(){if(g.stopOnError&&b.length>0)return $.isFunction(g.errorCallback)?g.errorCallback(b):g.callback(b),void 0;if(d>c){var f=a[c++];f.validator.call(f.target,b,e)}else g.callback(b)}()},j=function(a){var b=$.type(a),c="";if("string"===b&&(/^[\w\d]+$/.test(a)?a=c='[name="'+a+'"]':c=a),a=$(a,f),!(a instanceof jQuery))throw"InvalidTarget";if(0===a.length)throw"EmptyJqueryTarget "+c;return 1===a.length||a.length>1,a},k=function(a){var b=$.type(a);if("string"===b){if(a=$(a),0===a.length)throw"FormNotFound"}else if("object"!==b)throw"InvalidForm";return a},l=function(a){var b=[],c=$.type(a);if("regexp"===c)b.push(function(b,c){a.test(this.val())||b.push(d.error(this,"The pattern "+a.toString()+" does not match.")),c()});else if("string"===c){if(!(a in d.validators))throw"InvalidPredefinedValidator";b.push(d.validators[a])}else if("function"===c)b.push(a);else{if("array"!==c)throw"InvalidValidator";$.each(a,function(a,c){$.each(l(c),function(a,c){b.push(c)})})}return b};this.addRule=function(a,c,d){d=d||{};var e=j(a),k=l(c),m=g.instantAll||"instant"in d&&!0===d.instant,n="instantOnly"in d&&!0===d.instantOnly,o=[];return $(k).each(function(a,c){var f=new b(e,c,d);m&&o.push(f),n||h.push(f)}),o.length>0&&(e.length>1?e.last():e).bind("blur",function(){i.call(f,o,g)}),this},this.validate=function(){$.isFunction(g.cleanup)&&g.cleanup.call(f),i.call(f,h)},f=k(a),f.bind("submit",$.proxy(function(a){a.preventDefault(),this.validate()},this))};return d.validators={},d.create=function(a,b){b=b||{};var c=new d(a,b);return c},d.registerValidator=function(a,b){d.validators[a]=b},d.error=function(b,c){return new a(b,c)},d.patternValidator=function(a,b){return function(c,e){a.test(this.val())||c.push(d.error(this,b)),e()}},d.registerValidator("isEmail",function(a,b){var c=/^([\w\.\-\+\=]+)@((?:[a-z0-9\-_]+\.)+[a-z]{2,6})$/i;c.test(this.val())||a.push(d.error(this,"invalid email.")),b()}),d.registerValidator("isNotEmpty",function(a,b){this.each(function(){var b=$(this);_.isEmpty(b.val())&&a.push(d.error(b,"is empty."))}),b()}),d.registerValidator("noop",function(a,b){b()}),d}();!function(){$.fn.validate=function(a,b){return b=b||{},$(this).each(function(){var c=$(this),d=FormBouncer.create(c,b);$(a).each(function(){d.addRule.apply(c,this)})})}}(jQuery),function(){$.fn.validate=function(a,b){return b=b||{},$(this).each(function(){var c=$(this),d=FormBouncer.create(c,b);$(a).each(function(){d.addRule.apply(c,this)})})}}(jQuery);