<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>ButFriendly's FormBouncer</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="lib/bootstrap/bootstrap.css" rel="stylesheet">
	<style>
		body {
			padding-top: 20px;
			padding-bottom: 20px;
		}

		.header,
		.contents,
		.footer {
			padding-left: 15px;
			padding-right: 15px;
		}

		.header {
			border-bottom: 1px solid #e5e5e5;
		}

		.header h3 {
			margin-top: 0;
			margin-bottom: 0;
			line-height: 40px;
			padding-bottom: 19px;
		}

		.footer {
			padding-top: 19px;
			color: #777;
			border-top: 1px solid #e5e5e5;
		}

		@media (min-width: 768px) {
			.container {
				max-width: 730px;
			}
		}

		.container-narrow > hr {
			margin: 30px 0;
		}

		.jumbotron {
			text-align: center;
			border-bottom: 1px solid #e5e5e5;
		}

		.jumbotron .btn {
			font-size: 21px;
			padding: 14px 24px;
		}

		.contents {
			margin: 40px 0;
		}

		.contents p + h4 {
			margin-top: 28px;
		}

		@media screen and (min-width: 768px) {
			.header,
			.marketing,
			.footer {
				padding-left: 0;
				padding-right: 0;
			}
			.header {
				margin-bottom: 30px;
			}
			.jumbotron {
				border-bottom: 0;
			}
		}
	</style>
</head>
<body>
<div class="container">
	<div class="jumbotron">
		<h1>ButFriendly's FormBouncer</h1>
		<p>ButFriendly's Formbouncer is a mighty and powerful client-side Form-Validator.</p>
	</div>

	<div class="row contents">
		<h2>Demo</h2>
		<form id="whoo" method="post" role="form">
			<div class="form-group">
				<label class="control-label" for="fe-gender">Gender</label>
				<p class="help-block"></p>
				<div class="radio">
					<label>
						<input type="radio" name="gender" id="fe-gender-m" value="m">
						Male
					</label>
				</div>
				<div class="radio">
					<label>
						<input type="radio" name="gender" id="fe-gender-f" value="f">
						Female
					</label>
				</div>
			</div>

			<div class="form-inline">
				<div class="form-group">
					<label class="control-label" for="fe-firstname">Firstname</label>
					<input type="text" name="firstname" class="form-control" id="fe-firstname" placeholder="Firstname">
					<p class="help-block"></p>
				</div>
				<div class="form-group">
					<label class="control-label" for="fe-lastname">Lastname</label>
					<input type="text" name="lastname" class="form-control" id="fe-lastname" placeholder="Lastname">
					<p class="help-block"></p>
				</div>
			</div>

			<div class="form-inline">
				<div class="form-group">
					<label class="control-label" for="fe-email">Email</label>
					<input type="text" name="email" class="form-control" id="fe-email" placeholder="Email">
					<p class="help-block"></p>

				</div>
				<div class="form-group">
					<label class="control-label" for="fe-password">Password</label>
					<input type="password" name="password" class="form-control" id="fe-password" placeholder="Password">
					<p class="help-block"></p>
				</div>
			</div>

			<div class="form-group">
				<label for="fe-letter">Letter</label>
				<select name="letter" id="fe-letter" class="form-control">
					<option value="">- Choose -</option>
					<option value="A">A</option>
					<option value="B">B</option>
					<option value="C">C</option>
				</select>
				<p class="help-block"></p>
			</div>

			<div class="form-group">
				<label for="fe-area">Textarea</label>
				<textarea name="area" id="fe-area" cols="60" rows="4" class="form-control"></textarea>
				<p class="help-block"></p>
			</div>

			<div class="form-inline form-group">
				<label for="fe-date">Date</label>
				<p class="help-block"></p>
				<div class="form-group">
					<select name="date-day" id="fe-date-day" class="form-control">
						<option value="">- Day -</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
					</select>
				</div>
				<div class="form-group">
					<select name="date-month" id="fe-date-month" class="form-control">
						<option value="">- Month -</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
					</select>
				</div>
				<div class="form-group">
					<select name="date-year" id="fe-date-year" class="form-control">
						<option value="">- Year -</option>
						<option value="2008">2008</option>
						<option value="2009">2009</option>
						<option value="2010">2010</option>
					</select>
				</div>
			</div>

			<div class="form-inline form-group">
				<label for="fe-birthdate">Birthdate</label>
				<p class="help-block"></p>
				<div class="form-group">
					<select name="birthdate-day" id="fe-birthdate-day" class="form-control">
						<option value="">- Day -</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
					</select>
				</div>
				<div class="form-group">
					<select name="birthdate-month" id="fe-birthdate-month" class="form-control">
						<option value="">- Month -</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
						<option value="7">7</option>
						<option value="8">8</option>
						<option value="9">9</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
					</select>
				</div>
				<div class="form-group">
					<select name="birthdate-year" id="fe-birthdate-year" class="form-control">
						<option value="">- Year -</option>
						<option value="2008">2008</option>
						<option value="2009">2009</option>
						<option value="2010">2010</option>
						<option value="2011">2011</option>
						<option value="2012">2012</option>
						<option value="2013">2013</option>
					</select>
				</div>
			</div>

			<div class="form-group">
				<button type="submit" class="btn btn-default">Sign in</button>
			</div>
		</form>
	</div>
</div>

<script type="text/javascript" src="lib/jquery/jquery.js"></script>
<script type="text/javascript" src="lib/underscore/underscore-min.js"></script>
<script src="lib/bootstrap/bootstrap.js"></script>

<script type="text/javascript" src="../dist/formbouncer.min.js"></script>
<script type="text/javascript">
	var isGender = function(errors, next) {
		var $el = this.filter(':checked');
		if (0 === $el.length) {			
			errors.push(FormBouncer.error(this, 'No gender chosen'));
		}
		else if (_.indexOf(['m', 'w'], $el.val()) === -1) {
			errors.push(FormBouncer.error($el, 'Invalid gender'));
		}
		next();
	}

	/* Stupid example for a date validator which is in NO WAY useful. */
	var isValidDate = function(errors, next) {
		var d = this.filter('*[name$="-day"]').val();
		var m = this.filter('*[name$="-month"]').val();
		var y = this.filter('*[name$="-year"]').val();

		if (!$.isNumeric(d) || !$.isNumeric(m) ||Â !$.isNumeric(y)) {
			errors.push(FormBouncer.error(this, 'Invalid date'));
		}

		next();
	}

	$(function() {
		// Attach the bouncer to form with id #whoo
		var bouncer = FormBouncer.create('#whoo', {
			// Validate the whole form
			stopOnError: false,

			// Clean-up the form end remove errors
			cleanup: function() {
				$('.help-block').empty();
				$('.has-error', this).removeClass('has-error');
			},

			// Callback which gets called after validation
			callback: function(errors) { 
				$.each(errors, function(i, e) {
					// Look-up form group of affected field
					var formGroup = e.target.parents('.form-group').last();

					// Mark group as errorneous
					formGroup.addClass('has-error');

					var elementId = e.target.attr('id');
					// Strip last token of multi-fields
					if (e.target.length > 1) {
						elementId = elementId.slice(0, elementId.lastIndexOf('-'))
					}

					var $label = $('label[for="'+elementId+'"]');
					var $helpBlock = $label.siblings('.help-block');

					if ($helpBlock.length == 1) {
						$helpBlock.html(e.message);
					}
					else {
						$label.html($label.text() + e.message);
					}
				});
			}
		});

		// We attach a pattern validator to the firstname, which supports
		// custom error-messages if the validator fails
		bouncer.addRule('firstname', FormBouncer.patternValidator(/^[\w]{3,}$/, 'The firstname must be at least 3 chars long'));

		// We attach two validators to the "lastname" field
		// At first a simple regex. And second the noop valiadator.
		bouncer.addRule('lastname', [/^[\w]{5,}$/, 'noop']);

		// We attach two validator to the email field an instruct
		// the formbouncer to validate it instantly as soon as you
		// leave the field - and only instantly.
		bouncer.addRule('email', ['noop', 'isEmail'], { 
			instant: true, 
			instantOnly: true
		});

		bouncer.addRule('gender', isGender);

		bouncer.addRule('letter', /[AB]/);

		bouncer.addRule('area', [/^[\w]{5,}$/, 'noop']);

		bouncer.addRule('*[name^="date-"]', isValidDate, { instant: true });

		bouncer.addRule($('*[name^="birthdate-"]'), isValidDate, { instant: true });
	});
</script>
</body>
</html>
