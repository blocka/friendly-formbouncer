<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>ButFriendly's FormBouncer</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="../components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="../components/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet">
	<style>
		body { 
			font-family: "Helvetica Neue", Helvetica, sans-serif;
			font-size: 14px;
			padding: 2em;
		}
	</style>
</head>
<body>
<div class="container">
	<div class="header">
		<!--
		<h1 class="text-muted">ButFriendly's FormBouncer</h1>
		-->
	</div>

	<div class="jumbotron">
	</div>

	<form id="whoo" method="post" role="form">
		<div class="form-group">
			<div class="radio">
				<label>
					<input type="radio" name="gender" id="title_m" value="m">
					Male
				</label>
			</div>
			<div class="radio">
				<label>
					<input type="radio" name="gender" id="title_w" value="f">
					Female
				</label>
			</div>
			<p class="help-block"></p>
		</div>

		<div class="form-inline">
			<div class="form-group">
				<label class="control-label" for="fe-firstname">Firstname</label>
				<input type="text" name="firstname" class="form-control" id="fe-firstname" placeholder="Firstname">
				<p class="help-block"></p>
			</div>
			<div class="form-group">
				<label class="control-label" for="fe-lastname">Lastname</label>
				<input type="text" name="lastname" class="form-control" id="fe-lastname" placeholder="Lastname">
				<p class="help-block"></p>
			</div>
		</div>

		<div class="form-inline">
			<div class="form-group">
				<label class="control-label" for="fe-email">Email</label>
				<input type="text" name="email" class="form-control" id="fe-email" placeholder="Email">
				<p class="help-block"></p>

			</div>
			<div class="form-group">
				<label class="control-label" for="fe-password">Password</label>
				<input type="password" name="password" class="form-control" id="fe-password" placeholder="Password">
				<p class="help-block"></p>
			</div>
		</div>

		<div class="form-group">
			<label for="fe-letter">Letter</label>
			<select name="letter" id="fe-letter" class="form-control">
				<option value="">- Choose -</option>
				<option value="A">A</option>
				<option value="B">B</option>
				<option value="C">C</option>
			</select>
			<p class="help-block"></p>
		</div>

		<div class="form-group">
			<label for="fe-area">Textarea</label>
			<textarea name="area" id="fe-area" cols="60" rows="4" class="form-control"></textarea>
			<p class="help-block"></p>
		</div>

		<div class="form-inline form-group">
			<label for="fe-date">Date</label>
			<p class="help-block"></p>
			<div class="form-group">
				<select name="date-day" id="fe-date-day" class="form-control">
					<option value="">- Day -</option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
				</select>
			</div>
			<div class="form-group">
				<select name="date-month" id="fe-date-month" class="form-control">
					<option value="">- Month -</option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
				</select>
			</div>
			<div class="form-group">
				<select name="date-year" id="fe-date-year" class="form-control">
					<option value="">- Year -</option>
					<option value="2008">2008</option>
					<option value="2009">2009</option>
					<option value="2010">2010</option>
				</select>
			</div>
		</div>

		<div class="form-inline form-group">
			<label for="fe-birthdate">Birthdate</label>
			<p class="help-block"></p>
			<div class="form-group">
				<select name="birthdate-day" id="fe-birthdate-day" class="form-control">
					<option value="">- Day -</option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
				</select>
			</div>
			<div class="form-group">
				<select name="birthdate-month" id="fe-birthdate-month" class="form-control">
					<option value="">- Month -</option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8">8</option>
					<option value="9">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
				</select>
			</div>
			<div class="form-group">
				<select name="birthdate-year" id="fe-birthdate-year" class="form-control">
					<option value="">- Year -</option>
					<option value="2008">2008</option>
					<option value="2009">2009</option>
					<option value="2010">2010</option>
					<option value="2011">2011</option>
					<option value="2012">2012</option>
					<option value="2013">2013</option>
				</select>
			</div>
		</div>

		<div class="form-group">
			<button type="submit" class="btn btn-default">Sign in</button>
		</div>
	</form>
</div>

<script type="text/javascript" src="../components/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../components/underscore/underscore-min.js"></script>
<script src="../components/bootstrap/dist/js/bootstrap.min.js"></script>

<script type="text/javascript" src="../dist/formbouncer.min.js"></script>
<script type="text/javascript">
	var isGender = function(errors, next) {
		var $el = this.filter(':checked');
		if (0 === $el.length) {			
			errors.push(FormBouncer.error($el, 'No gender chosen'));
		}
		else if (_.indexOf(['m', 'w'], $el.val()) === -1) {
			errors.push(FormBouncer.error($el, 'Invalid gender'));
		}
		next();
	}

	/* Stupid example for a date validator which is in NO WAY useful. */
	var isValidDate = function(errors, next) {
		var d = this.filter('*[name$="-day"]').val();
		var m = this.filter('*[name$="-month"]').val();
		var y = this.filter('*[name$="-year"]').val();

		if (!$.isNumeric(d) || !$.isNumeric(m) ||Â !$.isNumeric(y)) {
			errors.push(FormBouncer.error(this, 'Invalid date'));
		}

		next();
	}

	$(function() {
		var bouncer = FormBouncer.create('#whoo', {
			stopOnError: false,
			cleanup: function() {
				$('.has-error', this).removeClass('has-error');
			},
			callback: function(errors) { 
				$.each(errors, function(i, e) {
					// Look-up form group of affected field
					var formGroup = e.target.parents('.form-group').last();

					// Mark as errorneous
					formGroup.addClass('has-error');

					var elementId = e.target.attr('id');
					// Strip last token of multi-fields
					if (e.target.length > 1) {
						elementId = elementId.slice(0, elementId.lastIndexOf('-'))
					}

					var $label = $('label[for="'+elementId+'"]');
					var $helpBlock = $label.siblings('.help-block');

					if ($helpBlock.length == 1) {
						$helpBlock.html(e.message);
					}
					else {
						$label.html($label.text() + e.message);
					}
				});
			}
		});
		bouncer.addRule('firstname', FormBouncer.patternValidator(/^[\w]{3,}$/, 'The firstname must be at least 3 chars long'))
		       .addRule('lastname', [/^[\w]{5,}$/, 'noop'])
		       .addRule('email', ['noop', 'isEmail'], { instant: true, instantOnly: true })
		       .addRule('gender', isGender)
		       .addRule('letter', /[AB]/)
		       .addRule('area', [/^[\w]{5,}$/, 'noop'])
		       .addRule('*[name^="date-"]', isValidDate, { instant: true })
		       .addRule($('*[name^="birthdate-"]'), isValidDate, { instant: true });
	});
</script>
</body>
</html>
